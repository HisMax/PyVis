<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>物理现象可视化实验室</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
    <nav class="navbar navbar-dark mb-4">
        <div class="container">
            <a class="navbar-brand">
                <i class="material-icons">science</i>
                物理现象可视化实验室
            </a>
            <div class="navbar-text text-light">
                <small>作者：HistoneMax</small>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="row g-4">
            <div class="col-md-3">
                <div class="sidebar">
                    <div class="list-group">
                        <a href="#" class="list-group-item list-group-item-action active" data-experiment="lissajous">
                            <i class="material-icons">track_changes</i>
                            利萨如图形
                        </a>
                        <a href="#" class="list-group-item list-group-item-action" data-experiment="standing-wave">
                            <i class="material-icons">waves</i>
                            驻波
                        </a>
                        <a href="#" class="list-group-item list-group-item-action" data-experiment="wave-superposition">
                            <i class="material-icons">compare_arrows</i>
                            波的叠加
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="col-md-9">
                <!-- 利萨如图形 -->
                <div id="lissajous-experiment" class="experiment">
                    <h3>
                        <i class="material-icons">track_changes</i>
                        利萨如图形
                    </h3>
                    <div class="control-panel">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="show-animation" checked>
                                        <label class="form-check-label">动态显示</label>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">X频率 (fx): <span id="freq-x-value">3.0</span></label>
                                    <input type="range" class="form-range" id="freq-x" min="0.5" max="10" step="0.1" value="3">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Y频率 (fy): <span id="freq-y-value">2.0</span></label>
                                    <input type="range" class="form-range" id="freq-y" min="0.5" max="10" step="0.1" value="2">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">相位差 (φ): <span id="phase-value">90°</span></label>
                                    <input type="range" class="form-range" id="phase" min="0" max="360" value="90">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="info-panel">
                                    <h5>参数信息</h5>
                                    <p>频率比 (fy:fx): <span id="freq-ratio">2:3</span></p>
                                    <p>图形周期: <span id="period">2π</span></p>
                                    <p>当前时间: <span id="current-time">0.00</span> s</p>
                                    <div class="alert alert-info">
                                        x = A·sin(2πfx·t + φ)<br>
                                        y = A·sin(2πfy·t)
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-8">
                            <div id="lissajous" class="plot-container"></div>
                        </div>
                        <div class="col-md-4">
                            <div id="lissajous-projection" class="plot-container"></div>
                        </div>
                    </div>
                </div>

                <!-- 驻波 -->
                <div id="standing-wave-experiment" class="experiment" style="display: none;">
                    <h3>
                        <i class="material-icons">waves</i>
                        驻波模拟
                    </h3>
                    <div class="control-panel">
                        <div class="row">
                            <div class="col-md-6">
                                <!-- 波的基本参数 -->
                                <h5 class="mb-3">基本参数</h5>
                                <div class="mb-3">
                                    <label class="form-label">波速 (v): <span id="wave-speed-value">1.00</span> m/s</label>
                                    <input type="range" class="form-range" id="wave-speed" min="0.10" max="2.00" step="0.05" value="1.00">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">波长 (λ): <span id="wavelength-value">0.50</span> m</label>
                                    <input type="range" class="form-range" id="wavelength" min="0.20" max="1.00" step="0.05" value="0.50">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">振幅 (A): <span id="amplitude-value">1.00</span></label>
                                    <input type="range" class="form-range" id="amplitude" min="0.20" max="2.00" step="0.05" value="1.00">
                                </div>
                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="show-components">
                                        <label class="form-check-label">显示行波分量</label>
                                    </div>
                                </div>
                                <div class="btn-group">
                                    <button class="btn btn-primary" id="play-pause">
                                        <i class="material-icons">pause</i>
                                        暂停
                                    </button>
                                    <button class="btn btn-secondary" id="reset">
                                        <i class="material-icons">replay</i>
                                        重置
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="info-panel">
                                    <h5>物理参数</h5>
                                    <p>频率 (f): <span id="frequency-value">1.0</span> Hz</p>
                                    <p>角频率 (ω): <span id="angular-freq-value">6.28</span> rad/s</p>
                                    <p>波数 (k): <span id="wave-number-value">6.28</span> rad/m</p>
                                    <p>波节点数: <span id="node-count">2</span></p>
                                    <p>波腹点数: <span id="antinode-count">2</span></p>
                                    <p>波的周期 (T): <span id="period-value">1.00</span> s</p>
                                    <p>波的能量: <span id="energy-value">1.00</span> J</p>
                                    <div class="alert alert-info">
                                        前行波：y₁ = A·cos(kx - ωt)<br>
                                        反射波：y₂ = A·cos(kx + ωt)
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="standing-wave" class="plot-container"></div>
                    <div class="node-info mt-3">
                        <p class="text-muted">
                            <i class="material-icons" style="color: #f44336">fiber_manual_record</i> 波节点
                            <i class="material-icons ms-3" style="color: #4caf50">fiber_manual_record</i> 波腹点
                            <span class="ms-3" id="wave-components" style="display: none">
                                <span style="color: #2196f3">— 前行波</span>
                                <span class="ms-2" style="color: #ff9800">— 反射波</span>
                            </span>
                        </p>
                    </div>
                </div>

                <!-- 波的叠加 -->
                <div id="wave-superposition-experiment" class="experiment" style="display: none;">
                    <h3>
                        <i class="material-icons">compare_arrows</i>
                        波的叠加模拟
                    </h3>
                    <div class="control-panel">
                        <div class="row">
                            <div class="col-md-6">
                                <h5 class="mb-3">波1参数</h5>
                                <div class="mb-3">
                                    <label class="form-label">振幅 (A₁): <span id="amp1-value">1.00</span></label>
                                    <input type="range" class="form-range" id="amp1" min="0.00" max="2.00" step="0.05" value="1.00">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">频率 (f₁): <span id="freq1-value">1.00</span> Hz</label>
                                    <input type="range" class="form-range" id="freq1" min="0.20" max="5.00" step="0.05" value="1.00">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h5 class="mb-3">波2参数</h5>
                                <div class="mb-3">
                                    <label class="form-label">振幅 (A₂): <span id="amp2-value">1.00</span></label>
                                    <input type="range" class="form-range" id="amp2" min="0.00" max="2.00" step="0.05" value="1.00">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">频率 (f₂): <span id="freq2-value">2.00</span> Hz</label>
                                    <input type="range" class="form-range" id="freq2" min="0.20" max="5.00" step="0.05" value="2.00">
                                </div>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <h5 class="mb-3">显示设置</h5>
                                <div class="mb-2">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="show-wave1" checked>
                                        <label class="form-check-label">显示波1</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="show-wave2" checked>
                                        <label class="form-check-label">显示波2</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="info-panel">
                                    <h5>叠加分析</h5>
                                    <p>最大振幅: <span id="max-amplitude-value">2.00</span></p>
                                    <p>拍频: <span id="beat-frequency-value">1.00</span> Hz</p>
                                    <div class="alert alert-info">
                                        y = A₁·sin(2πf₁t) + A₂·sin(2πf₂t)<br>
                                        拍频 = |f₁ - f₂|
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="wave-superposition" class="plot-container"></div>
                    <div class="node-info mt-3">
                        <p class="text-muted">
                            <span style="color: #2979ff">— 波1</span>
                            <span class="ms-3" style="color: #00b0ff">— 波2</span>
                            <span class="ms-3" style="color: #304ffe">— 叠加波</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const CONFIG = {
            frameRate: 60,
            timeStep: 0.02
        };

        let currentExperiment = 'lissajous';
        let isPlaying = true;
        let currentTime = 0;
        let animationId = null;
        let lissajousAnimationId = null;
        let currentLissajousTime = 0;
        let currentView = 'xy';

        // 通用图表配置
        const baseLayout = {
            showlegend: false,
            margin: { l: 50, r: 30, t: 50, b: 50 },
            plot_bgcolor: '#fff',
            paper_bgcolor: '#fff',
            font: {
                family: 'Segoe UI',
                size: 14
            },
            xaxis: {
                showgrid: true,
                gridcolor: '#f0f0f0',
                zeroline: true,
                zerolinecolor: '#e0e0e0'
            },
            yaxis: {
                showgrid: true,
                gridcolor: '#f0f0f0',
                zeroline: true,
                zerolinecolor: '#e0e0e0'
            }
        };

        // 更新参数显示
        function updateValues() {
            $('#freq-x-value').text(parseFloat($('#freq-x').val()).toFixed(1));
            $('#freq-y-value').text(parseFloat($('#freq-y').val()).toFixed(1));
            $('#phase-value').text($('#phase').val() + '°');
            $('#wave-speed-value').text(parseFloat($('#wave-speed').val()).toFixed(1));
            $('#amp1-value').text(parseFloat($('#amp1').val()).toFixed(1));
            $('#amp2-value').text(parseFloat($('#amp2').val()).toFixed(1));
            $('#freq1-value').text(parseFloat($('#freq1').val()).toFixed(1));
            $('#freq2-value').text(parseFloat($('#freq2').val()).toFixed(1));
            const wavelength = parseFloat($('#wavelength').val());
            const speed = parseFloat($('#wave-speed').val());
            const amplitude = parseFloat($('#amplitude').val());
            const phase = parseFloat($('#phase').val()) * Math.PI / 180;
            
            const frequency = speed / wavelength;
            const angularFreq = 2 * Math.PI * frequency;
            const waveNumber = 2 * Math.PI / wavelength;
            const period = 1 / frequency;
            const energy = 0.5 * amplitude * amplitude * frequency * frequency;
            
            $('#wavelength-value').text(wavelength.toFixed(2));
            $('#frequency-value').text(frequency.toFixed(2));
            $('#angular-freq-value').text(angularFreq.toFixed(2));
            $('#wave-number-value').text(waveNumber.toFixed(2));
            $('#amplitude-value').text(amplitude.toFixed(2));
            $('#phase-value').text(phase + '°');
            $('#period-value').text(period.toFixed(2));
            $('#energy-value').text(energy.toFixed(2));
        }

        // 利萨如图形更新
        function updateLissajous() {
            const freqX = parseFloat($('#freq-x').val());
            const freqY = parseFloat($('#freq-y').val());
            const phase = parseFloat($('#phase').val()) * Math.PI / 180;
            const showAnimation = $('#show-animation').prop('checked');

            // 更新频率比和周期信息
            const gcd = calculateGCD(freqX * 10, freqY * 10) / 10;
            const ratioX = (freqX / gcd).toFixed(1);
            const ratioY = (freqY / gcd).toFixed(1);
            $('#freq-ratio').text(`${ratioY}:${ratioX}`);
            $('#period').text(`${ratioX}π`);

            // 停止现有的动画
            if (lissajousAnimationId) {
                cancelAnimationFrame(lissajousAnimationId);
            }

            // 重置时间
            currentLissajousTime = 0;

            const layout = {
                ...baseLayout,
                title: {
                    text: '利萨如图形',
                    font: { size: 24 }
                },
                xaxis: {
                    ...baseLayout.xaxis,
                    range: [-1.5, 1.5],
                    title: 'x = A·sin(2πfx·t + φ)'
                },
                yaxis: {
                    ...baseLayout.yaxis,
                    range: [-1.5, 1.5],
                    title: 'y = A·sin(2πfy·t)',
                    scaleanchor: 'x',
                    scaleratio: 1
                }
            };

            if (showAnimation) {
                // 计算一个完整周期所需的时间
                const periodTime = (freqX / gcd) / freqX * 2 * Math.PI;
                let isDrawing = true;
                let lastPauseTime = 0;

                function animate(timestamp) {
                    if (isDrawing) {
                        // 生成点
                        const points = 500;  // 增加点数使曲线更平滑
                        const t = Array.from({length: points}, (_, i) => 
                            (i * currentLissajousTime) / (points - 1)
                        );
                        const x = t.map(t => Math.sin(2 * Math.PI * freqX * t + phase));
                        const y = t.map(t => Math.sin(2 * Math.PI * freqY * t));

                        Plotly.newPlot('lissajous', [{
                            x: x,
                            y: y,
                            mode: 'lines',
                            line: {
                                color: '#1976d2',
                                width: 2
                            }
                        }], layout, {responsive: true});

                        currentLissajousTime += 0.02;
                        $('#current-time').text(currentLissajousTime.toFixed(2));

                        // 检查是否完成一个周期
                        if (currentLissajousTime >= periodTime) {
                            isDrawing = false;
                            lastPauseTime = timestamp;
                        }
                    } else {
                        // 暂停0.6秒后重新开始
                        if (timestamp - lastPauseTime >= 600) {
                            currentLissajousTime = 0;
                            isDrawing = true;
                        }
                    }

                    lissajousAnimationId = requestAnimationFrame(animate);
                }

                // 开始动画前先清空图形
                Plotly.newPlot('lissajous', [{
                    x: [],
                    y: [],
                    mode: 'lines',
                    line: {
                        color: '#1976d2',
                        width: 2
                    }
                }], layout, {responsive: true});

                animate(performance.now());
            } else {
                // 静态模式 - 绘制完整的利萨如图形
                const points = 1000;  // 使用更多的点以获得更平滑的曲线
                const t = Array.from({length: points}, (_, i) => (2 * Math.PI * i) / (points - 1));
                const x = t.map(t => Math.sin(freqX * t + phase));
                const y = t.map(t => Math.sin(freqY * t));

                Plotly.newPlot('lissajous', [{
                    x: x,
                    y: y,
                    mode: 'lines',
                    line: {
                        color: '#1976d2',
                        width: 2
                    }
                }], layout, {responsive: true});
            }
        }

        // 添加辅助函数计算最大公约数
        function calculateGCD(a, b) {
            a = Math.abs(a);
            b = Math.abs(b);
            while (b) {
                let t = b;
                b = a % b;
                a = t;
            }
            return a;
        }

        // 驻波更新
        function updateStandingWave() {
            if (!isPlaying || currentExperiment !== 'standing-wave') return;

            const speed = parseFloat($('#wave-speed').val());
            const wavelength = parseFloat($('#wavelength').val());
            const amplitude = parseFloat($('#amplitude').val());
            
            const k = 2 * Math.PI / wavelength;
            const omega = k * speed;
            currentTime += CONFIG.timeStep * speed;

            $.get(`/api/standing_wave?t=${currentTime}&k=${k}&omega=${omega}&amplitude=${amplitude}`, function(data) {
                const traces = [];
                
                // 添加行波分量（如果选中显示）
                if ($('#show-components').prop('checked')) {
                    traces.push({
                        x: data.x,
                        y: data.forward_wave,
                        name: '前行波',
                        mode: 'lines',
                        line: { color: '#2196f3', width: 1.5, dash: 'dot' }
                    });
                    traces.push({
                        x: data.x,
                        y: data.backward_wave,
                        name: '反射波',
                        mode: 'lines',
                        line: { color: '#ff9800', width: 1.5, dash: 'dot' }
                    });
                }

                // 添加驻波
                traces.push({
                    x: data.x,
                    y: data.y,
                    name: '驻波',
                    mode: 'lines',
                    line: { color: '#1976d2', width: 3 }
                });

                // 添加波节点和波腹点
                traces.push({
                    x: data.nodes,
                    y: Array(data.nodes.length).fill(0),
                    mode: 'markers',
                    marker: {
                        color: '#f44336',
                        size: 10,
                        symbol: 'circle'
                    },
                    name: '波节点',
                    showlegend: false
                });

                traces.push({
                    x: data.antinodes,
                    y: Array(data.antinodes.length).fill(0),
                    mode: 'markers',
                    marker: {
                        color: '#4caf50',
                        size: 10,
                        symbol: 'circle'
                    },
                    name: '波腹点',
                    showlegend: false
                });

                const layout = {
                    ...baseLayout,
                    title: {
                        text: '驻波',
                        font: { size: 24 }
                    },
                    showlegend: $('#show-components').prop('checked'),
                    legend: {
                        x: 1,
                        xanchor: 'right',
                        y: 1
                    },
                    xaxis: {
                        ...baseLayout.xaxis,
                        range: [0, 1],
                        title: {
                            text: '位置 (x/L)',
                            font: {
                                size: 12,
                                family: 'SF Mono, Consolas, monospace'
                            }
                        }
                    },
                    yaxis: {
                        ...baseLayout.yaxis,
                        range: [-2.5, 2.5],
                        title: {
                            text: '振幅 (A)',
                            font: {
                                size: 12,
                                family: 'SF Mono, Consolas, monospace'
                            }
                        }
                    }
                };

                Plotly.newPlot('standing-wave', traces, layout, {
                    responsive: true,
                    displayModeBar: true,
                    modeBarButtonsToAdd: ['drawline', 'eraseshape'],
                    modeBarButtonsToRemove: ['lasso2d', 'select2d']
                });

                // 更新波节点数显示
                $('#node-count').text(data.nodes.length - 1);
                $('#antinode-count').text(data.antinodes.length);
                
                animationId = setTimeout(() => {
                    requestAnimationFrame(updateStandingWave);
                }, 1000 / CONFIG.frameRate);
            });
        }

        // 添加行波显示切换事件
        $('#show-components').change(function() {
            $('#wave-components').toggle(this.checked);
        });

        // 波的叠加更新
        function updateWaveSuperposition() {
            const params = {
                amp1: parseFloat($('#amp1').val()),
                freq1: parseFloat($('#freq1').val()),
                amp2: parseFloat($('#amp2').val()),
                freq2: parseFloat($('#freq2').val())
            };

            // 计算物理参数
            const maxAmplitude = params.amp1 + params.amp2;
            const beatFrequency = Math.abs(params.freq1 - params.freq2);
            
            // 更新参数显示
            $('#max-amplitude-value').text(maxAmplitude.toFixed(2));
            $('#beat-frequency-value').text(beatFrequency.toFixed(2));

            // 获取显示设置
            const showWave1 = $('#show-wave1').prop('checked');
            const showWave2 = $('#show-wave2').prop('checked');

            $.get('/api/wave_superposition', params, function(data) {
                const traces = [];
                
                // 添加波1
                if (showWave1) {
                    traces.push({
                        x: data.x,
                        y: data.wave1,
                        name: '波1',
                        mode: 'lines',
                        line: { color: '#2979ff', width: 2 }
                    });
                }

                // 添加波2
                if (showWave2) {
                    traces.push({
                        x: data.x,
                        y: data.wave2,
                        name: '波2',
                        mode: 'lines',
                        line: { color: '#00b0ff', width: 2 }
                    });
                }

                // 添加叠加波
                traces.push({
                    x: data.x,
                    y: data.superposition,
                    name: '叠加波',
                    mode: 'lines',
                    line: { color: '#304ffe', width: 2.5 }
                });

                const layout = {
                    ...baseLayout,
                    title: {
                        text: '波的叠加',
                        font: { size: 24 }
                    },
                    showlegend: false,
                    xaxis: {
                        ...baseLayout.xaxis,
                        title: {
                            text: '位置 (x)',
                            font: {
                                size: 12,
                                family: 'SF Mono, Consolas, monospace'
                            }
                        }
                    },
                    yaxis: {
                        ...baseLayout.yaxis,
                        title: {
                            text: '振幅 (A)',
                            font: {
                                size: 12,
                                family: 'SF Mono, Consolas, monospace'
                            }
                        },
                        range: [-4, 4]
                    }
                };

                Plotly.newPlot('wave-superposition', traces, layout, {
                    responsive: true,
                    displayModeBar: true,
                    modeBarButtonsToAdd: ['drawline', 'eraseshape'],
                    modeBarButtonsToRemove: ['lasso2d', 'select2d']
                });
            });
        }

        // 添加波形显示切换事件监听
        $('#show-wave1, #show-wave2').on('change', function() {
            updateWaveSuperposition();
        });

        // 切换实验
        function switchExperiment(experimentId) {
            $('.experiment').hide();
            $(`#${experimentId}-experiment`).show();
            $('.list-group-item').removeClass('active');
            $(`[data-experiment="${experimentId}"]`).addClass('active');
            
            if (animationId) {
                clearTimeout(animationId);
                animationId = null;
            }
            
            currentExperiment = experimentId;

            switch(experimentId) {
                case 'lissajous':
                    updateLissajous();
                    break;
                case 'standing-wave':
                    if (isPlaying) {
                        updateStandingWave();
                    }
                    break;
                case 'wave-superposition':
                    updateWaveSuperposition();
                    break;
            }
        }

        // 事件监听
        $(document).ready(function() {
            // 初始化参数显示
            updateValues();
            
            // 初始化第一个实验
            updateLissajous();

            // 实验切换
            $('.list-group-item').click(function(e) {
                e.preventDefault();
                switchExperiment($(this).data('experiment'));
            });

            // 参数更新
            $('.form-range').on('input', function() {
                updateValues();
                if (currentExperiment === 'lissajous') {
                    // 每次参数变化都重新开始动画
                    currentLissajousTime = 0;
                    updateLissajous();
                } else if (currentExperiment === 'wave-superposition') {
                    updateWaveSuperposition();
                }
            });

            // 驻波控制
            $('#play-pause').click(function() {
                isPlaying = !isPlaying;
                $(this).text(isPlaying ? '暂停' : '播放');
                if (isPlaying && currentExperiment === 'standing-wave') {
                    updateStandingWave();
                }
            });

            $('#reset').click(function() {
                currentTime = 0;
                $('#wave-speed').val(1);
                updateValues();
                if (currentExperiment === 'standing-wave' && isPlaying) {
                    updateStandingWave();
                }
            });

            // 窗口大小改变时重绘图表
            let resizeTimeout;
            $(window).resize(function() {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(function() {
                    const plotDiv = document.getElementById(`${currentExperiment}`);
                    if (plotDiv) {
                        Plotly.Plots.resize(plotDiv);
                    }
                }, 250);
            });

            // 添加事件监听
            $('#show-animation').change(function() {
                if (!this.checked && lissajousAnimationId) {
                    cancelAnimationFrame(lissajousAnimationId);
                    currentLissajousTime = 0;
                }
                updateLissajous();
            });

            // 移除视图切换相关的事件监听
            $('#view-xy, #view-xt, #view-yt').off('click');
        });

        // 添加投影图更新函数
        function updateProjection(x, y, t) {
            const traces = [
                {
                    x: [0, x],
                    y: [y, y],
                    mode: 'lines',
                    line: { color: '#1976d2', width: 1, dash: 'dot' }
                },
                {
                    x: [x, x],
                    y: [0, y],
                    mode: 'lines',
                    line: { color: '#1976d2', width: 1, dash: 'dot' }
                },
                {
                    x: [x],
                    y: [y],
                    mode: 'markers',
                    marker: {
                        color: '#f44336',
                        size: 8
                    }
                }
            ];

            const layout = {
                ...baseLayout,
                title: {
                    text: '投影视图',
                    font: { size: 20 }
                },
                xaxis: {
                    range: [-1.5, 1.5],
                    title: 'x'
                },
                yaxis: {
                    range: [-1.5, 1.5],
                    title: 'y',
                    scaleanchor: 'x',
                    scaleratio: 1
                }
            };

            Plotly.newPlot('lissajous-projection', traces, layout, {responsive: true});
        }

        // 添加视图配置函数
        function getViewTitle() {
            switch(currentView) {
                case 'xy': return '利萨如图形 (XY平面)';
                case 'xt': return 'X分量时间图';
                case 'yt': return 'Y分量时间图';
            }
        }

        function getXAxisConfig() {
            switch(currentView) {
                case 'xy':
                    return {
                        range: [-1.5, 1.5],
                        title: 'x = A·sin(2πfx·t + φ)'
                    };
                case 'xt':
                case 'yt':
                    return {
                        title: '时间 (t)'
                    };
            }
        }

        function getYAxisConfig() {
            switch(currentView) {
                case 'xy':
                    return {
                        range: [-1.5, 1.5],
                        title: 'y = A·sin(2πfy·t)',
                        scaleanchor: 'x',
                        scaleratio: 1
                    };
                case 'xt':
                    return {
                        range: [-1.5, 1.5],
                        title: 'x(t)'
                    };
                case 'yt':
                    return {
                        range: [-1.5, 1.5],
                        title: 'y(t)'
                    };
            }
        }
    </script>
</body>
</html> 